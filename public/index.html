<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Result Portal</title>
    <link rel="icon" href="data:,">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, .serif { font-family: 'Playfair Display', serif; }
        
        /* Smooth Fade Animation for Slider */
        .fade-enter { opacity: 0; transition: opacity 1s ease-in-out; }
        .fade-enter-active { opacity: 1; }
        .fade-exit { opacity: 1; transition: opacity 1s ease-in-out; }
        .fade-exit-active { opacity: 0; }

        @media print {
            .no-print { display: none !important; }
            .print-border { border: 2px solid black !important; }
            body { background: white; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_URL = "/api"; 

        // --- ICONS ---
        const Icon = ({ name, size = 20, className="" }) => {
            const icons = {
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
                UploadCloud: <g><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></g>,
                Trash2: <g><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></g>,
                GraduationCap: <g><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></g>,
                Printer: <g><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></g>,
                Users: <g><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></g>,
                XCircle: <g><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></g>,
                ArrowRight: <path d="M5 12h14M12 5l7 7-7 7"/>,
                User: <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>,
                Lock: <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`inline-flex align-middle ${className}`}>
                    {icons[name] || <circle cx="12" cy="12" r="10"/>}
                </svg>
            );
        };

        const getGradePoint = (g) => {
            g = g ? g.toUpperCase().trim() : '';
            if(g==='O') return 10; if(g==='A+') return 9; if(g==='A') return 8;
            if(g==='B+') return 7; if(g==='B') return 6; if(g==='C') return 5;
            if(g==='P') return 4; return 0; 
        };

        // --- SPLIT SCREEN LOGIN ---
        const Login = ({ onLogin }) => {
            const [role, setRole] = useState('student');
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [day, setDay] = useState('');
            const [month, setMonth] = useState('');
            const [year, setYear] = useState('');
            const [msg, setMsg] = useState('');
            const [loading, setLoading] = useState(false);
            
            // Slider State
            const [slideIndex, setSlideIndex] = useState(0);
            const slides = [
                "https://images.unsplash.com/photo-1562774053-701939374585?q=80&w=1986&auto=format&fit=crop", // College Campus
                "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=2070&auto=format&fit=crop", // Library
                "https://images.unsplash.com/photo-1523240795612-9a054b0db644?q=80&w=2070&auto=format&fit=crop"  // Students
            ];

            useEffect(() => {
                const timer = setInterval(() => {
                    setSlideIndex((prev) => (prev + 1) % slides.length);
                }, 5000);
                return () => clearInterval(timer);
            }, []);

            const days = Array.from({length: 31}, (_, i) => i + 1);
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const currentYear = new Date().getFullYear();
            const years = Array.from({length: currentYear - 1989}, (_, i) => currentYear - i);

            const handleLogin = async (e) => {
                e.preventDefault();
                setMsg('');
                setLoading(true);
                
                let finalPassword = password;
                if (role === 'student') {
                    if (!day || !month || !year) { setMsg("‚ùå Select complete DOB"); setLoading(false); return; }
                    const m = months.indexOf(month) + 1;
                    finalPassword = `${year}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                }

                try {
                    const res = await fetch(`${API_URL}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password: finalPassword })
                    });
                    const data = await res.json();
                    if (res.ok) {
                        if (data.role !== role) { setMsg(`Access Denied: Not an ${role}`); } 
                        else { onLogin(data); }
                    } else { setMsg(data.message || "Invalid Credentials"); }
                } catch (err) { setMsg("Server connection failed"); }
                setLoading(false);
            };

            return (
                <div className="flex h-screen w-full bg-white">
                    {/* LEFT SIDE: SLIDER */}
                    <div className="hidden lg:flex w-1/2 relative bg-slate-900 overflow-hidden">
                        {slides.map((img, i) => (
                            <div key={i} className={`absolute inset-0 transition-opacity duration-1000 ${i === slideIndex ? 'opacity-100' : 'opacity-0'}`}>
                                <div className="absolute inset-0 bg-blue-900/40 mix-blend-multiply z-10"></div>
                                <img src={img} className="w-full h-full object-cover" />
                            </div>
                        ))}
                        <div className="relative z-20 m-auto text-center px-12 text-white">
                            <h2 className="text-5xl font-bold mb-4 serif tracking-wide">Excellence in Education</h2>
                            <p className="text-lg text-blue-100 font-light">Empowering the next generation of leaders and innovators.</p>
                        </div>
                        <div className="absolute bottom-10 left-0 w-full flex justify-center gap-2 z-20">
                            {slides.map((_, i) => (
                                <button key={i} onClick={() => setSlideIndex(i)} className={`h-2 rounded-full transition-all ${i === slideIndex ? 'w-8 bg-white' : 'w-2 bg-white/50'}`} />
                            ))}
                        </div>
                    </div>

                    {/* RIGHT SIDE: LOGIN FORM */}
                    <div className="w-full lg:w-1/2 flex items-center justify-center p-8 bg-slate-50">
                        <div className="w-full max-w-md">
                            <div className="mb-10">
                                <div className="inline-flex items-center gap-3 mb-2 text-blue-800">
                                    <Icon name="GraduationCap" size={32} />
                                    <span className="font-bold text-xl tracking-tight">UNIPORTAL</span>
                                </div>
                                <h1 className="text-3xl font-bold text-slate-900 serif">Welcome back</h1>
                                <p className="text-slate-500 mt-2">Please enter your details to access your dashboard.</p>
                            </div>

                            {/* TOGGLE */}
                            <div className="flex bg-slate-200 p-1 rounded-lg mb-8">
                                <button onClick={() => {setRole('student'); setMsg('')}} className={`flex-1 py-2 text-sm font-semibold rounded-md transition-all ${role === 'student' ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Student</button>
                                <button onClick={() => {setRole('admin'); setMsg('')}} className={`flex-1 py-2 text-sm font-semibold rounded-md transition-all ${role === 'admin' ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Admin</button>
                            </div>

                            {msg && <div className="bg-red-50 text-red-600 p-3 rounded-lg mb-6 text-sm font-medium border border-red-100 flex items-center gap-2"><Icon name="XCircle" size={16}/> {msg}</div>}

                            <form onSubmit={handleLogin} className="space-y-5">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1.5">{role === 'student' ? 'USN Number' : 'Username'}</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-3.5 text-slate-400"><Icon name="User" size={18}/></span>
                                        <input className="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition shadow-sm" 
                                            placeholder={role === 'student' ? "e.g. 3BR23CS001" : "Enter Username"} 
                                            value={username} onChange={e=>setUsername(e.target.value)} required />
                                    </div>
                                </div>

                                {role === 'student' ? (
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1.5">Date of Birth</label>
                                        <div className="flex gap-2">
                                            <select className="flex-1 p-3 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm cursor-pointer" value={day} onChange={e=>setDay(e.target.value)} required>
                                                <option value="">DD</option>{days.map(d=><option key={d}>{d}</option>)}
                                            </select>
                                            <select className="flex-1 p-3 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm cursor-pointer" value={month} onChange={e=>setMonth(e.target.value)} required>
                                                <option value="">Month</option>{months.map(m=><option key={m}>{m}</option>)}
                                            </select>
                                            <select className="flex-1 p-3 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm cursor-pointer" value={year} onChange={e=>setYear(e.target.value)} required>
                                                <option value="">YYYY</option>{years.map(y=><option key={y}>{y}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1.5">Password</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-3.5 text-slate-400"><Icon name="Lock" size={18}/></span>
                                            <input type="password" className="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition shadow-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={password} onChange={e=>setPassword(e.target.value)} required />
                                        </div>
                                    </div>
                                )}

                                <button disabled={loading} className="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 rounded-lg transition-all duration-200 shadow-md flex items-center justify-center gap-2">
                                    {loading ? "Processing..." : <span>Login <Icon name="ArrowRight" size={16}/></span>}
                                </button>
                            </form>
                            
                            <p className="text-center text-slate-400 text-xs mt-8">¬© 2025 University Result Management System</p>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ADMIN DASHBOARD ---
        const AdminDashboard = ({ user, onLogout }) => {
            const [status, setStatus] = useState('');
            const [deleteInput, setDeleteInput] = useState('');
            const [studentList, setStudentList] = useState([]);
            const [showList, setShowList] = useState(false);

            const handleUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (ev) => {
                    const lines = ev.target.result.split('\n');
                    const groupedData = {};
                    for (let i = 1; i < lines.length; i++) {
                        const row = lines[i].split(',').map(x => x.trim().replace(/^"|"$/g, ''));
                        if (row.length < 8) continue;
                        const [usn, name, dob, sem, sub, code, grd, crd] = row;
                        if(!usn) continue;
                        const key = `${usn}-${sem}`;
                        if (!groupedData[key]) groupedData[key] = { usn, studentName: name, dob, semester: sem, subjects: [] };
                        groupedData[key].subjects.push({ name: sub, code: code, grade: grd, credits: Number(crd) });
                    }
                    try {
                        setStatus(`Uploading...`);
                        const res = await fetch(`${API_URL}/results/bulk`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(Object.values(groupedData)) });
                        const d = await res.json();
                        setStatus(res.ok ? `‚úÖ ${d.message}` : `‚ùå ${d.message}`);
                        if(res.ok && showList) fetchStudents(); 
                    } catch (err) { setStatus('‚ùå Server Error'); }
                };
                reader.readAsText(file);
            };

            const handleDelete = async (target = null) => {
                const itemToDelete = target || deleteInput;
                if(!itemToDelete) return;
                if(!confirm(`‚ö†Ô∏è Permanently delete "${itemToDelete}"?`)) return;
                try {
                    const res = await fetch(`${API_URL}/results/delete-any`, { method: 'DELETE', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ query: itemToDelete }) });
                    const d = await res.json();
                    setStatus(res.ok ? `üóëÔ∏è ${d.message}` : `‚ùå ${d.message}`);
                    if(res.ok) { setDeleteInput(''); if(showList) fetchStudents(); }
                } catch(err) { setStatus("‚ùå Delete Failed"); }
            };

            const fetchStudents = async () => {
                try {
                    const res = await fetch(`${API_URL}/auth/users`);
                    const data = await res.json();
                    setStudentList(data);
                } catch(err) { console.error(err); }
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-10 h-full overflow-auto">
                    <div className="flex justify-between items-center mb-10"><h1 className="text-2xl font-bold flex items-center text-slate-800"><Icon name="Shield"/> Admin Console</h1><button onClick={onLogout} className="bg-white border px-4 py-2 rounded text-sm font-bold hover:bg-slate-50 transition shadow-sm text-red-600">Logout</button></div>
                    <div className="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto mb-10">
                        <div className="bg-white p-8 rounded-xl shadow-lg border border-slate-100 hover:shadow-xl transition">
                            <div className="mb-4 inline-block p-4 bg-blue-50 rounded-full text-blue-600"><Icon name="UploadCloud" size={32}/></div>
                            <h2 className="text-lg font-bold mb-2 text-slate-800">Upload Results</h2>
                            <div className="relative group cursor-pointer border-2 border-dashed border-slate-300 rounded-xl p-6 bg-slate-50 hover:bg-blue-50 transition mt-4">
                                <input type="file" accept=".csv" onChange={handleUpload} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                <p className="font-bold text-slate-600 group-hover:text-blue-600">Select CSV File</p>
                                <p className="text-xs text-gray-400 mt-2">Format: USN, Name, DOB, Sem, Sub, Code, Grd, Crd</p>
                            </div>
                        </div>
                        <div className="bg-white p-8 rounded-xl shadow-lg border border-slate-100 hover:shadow-xl transition">
                            <div className="mb-4 inline-block p-4 bg-red-50 rounded-full text-red-600"><Icon name="Trash2" size={32}/></div>
                            <h2 className="text-lg font-bold mb-2 text-slate-800">Clean Up Data</h2>
                            <p className="text-sm text-gray-500 mb-4">Enter <b>USN</b>, <b>Name</b> or <b>Semester</b></p>
                            <div className="flex gap-2"><input className="border p-2 rounded w-full outline-none focus:ring-2 focus:ring-red-200" placeholder='e.g. "3BR23CS001"' value={deleteInput} onChange={e=>setDeleteInput(e.target.value)} /><button onClick={() => handleDelete()} className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 font-bold">Delete</button></div>
                        </div>
                    </div>
                    {status && <div className="mt-8 p-4 bg-slate-800 text-white rounded font-bold text-center max-w-xl mx-auto shadow-lg mb-8">{status}</div>}
                    <div className="text-center">
                        <button onClick={() => { setShowList(!showList); if(!showList) fetchStudents(); }} className="bg-white border text-slate-600 hover:text-blue-700 px-6 py-3 rounded-full font-bold shadow-sm hover:shadow-md transition flex items-center gap-2 mx-auto">
                            <Icon name="Users"/> {showList ? 'Hide Students' : 'View Registered Students'}
                        </button>
                    </div>
                    {showList && (
                        <div className="mt-8 bg-white rounded-xl shadow overflow-hidden max-w-4xl mx-auto border border-gray-200">
                            <table className="w-full text-left text-sm">
                                <thead className="bg-gray-50 border-b text-gray-600 uppercase font-semibold"><tr><th className="p-4">USN</th><th className="p-4">Name</th><th className="p-4">Dept</th><th className="p-4 text-red-600">Password</th><th className="p-4 text-center">Action</th></tr></thead>
                                <tbody className="divide-y divide-gray-100">
                                    {studentList.map(s => (
                                        <tr key={s._id} className="hover:bg-gray-50">
                                            <td className="p-4 font-mono font-bold text-slate-700">{s.username}</td><td className="p-4 text-slate-600">{s.name}</td><td className="p-4 text-slate-500 text-xs">{s.department}</td><td className="p-4 font-mono text-red-500">{s.password}</td>
                                            <td className="p-4 text-center"><button onClick={() => handleDelete(s.username)} className="text-red-400 hover:text-red-600 p-2 rounded hover:bg-red-50 transition"><Icon name="XCircle" size={18}/></button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        };

        // --- STUDENT DASHBOARD ---
        const StudentDashboard = ({ user, onLogout }) => {
            const [allResults, setAllResults] = useState([]);
            const [selectedSem, setSelectedSem] = useState(null);
            const [stats, setStats] = useState({ creditsReg: 0, creditsEarned: 0, sgpa: 0, cgpa: 0 });

            const getBranchName = (dept) => {
                const map = { 'CS': 'COMPUTER SCIENCE & ENGINEERING', 'EC': 'ELECTRONICS & COMMUNICATION ENGG', 'ME': 'MECHANICAL ENGINEERING', 'CV': 'CIVIL ENGINEERING' };
                return map[dept] || dept + " ENGINEERING";
            };
            const getSemNumber = (semName) => parseInt(semName.match(/(\d+)/)?.[0] || 0);

            useEffect(() => {
                fetch(`${API_URL}/results/${user.id}`).then(r => r.json()).then(data => {
                    const sorted = data.sort((a,b) => getSemNumber(a.semester) - getSemNumber(b.semester));
                    setAllResults(sorted);
                    if(sorted.length > 0) handleSemChange(sorted.length - 1, sorted);
                });
            }, [user.id]);

            const handleSemChange = (index, fullData = allResults) => {
                const semData = fullData[index];
                setSelectedSem(semData);
                const currentSemNum = getSemNumber(semData.semester);
                let semCreditsReg = 0, semCreditsEarned = 0;
                semData.subjects.forEach(sub => {
                    const cred = Number(sub.credits);
                    semCreditsReg += cred;
                    if (sub.grade !== 'F' && sub.grade !== 'Ab') semCreditsEarned += cred;
                });
                let totalPoints = 0, totalCredits = 0;
                fullData.forEach(s => {
                    if (getSemNumber(s.semester) <= currentSemNum) {
                        s.subjects.forEach(sub => {
                            totalPoints += (getGradePoint(sub.grade) * Number(sub.credits));
                            totalCredits += Number(sub.credits);
                        });
                    }
                });
                const finalCGPA = totalCredits === 0 ? 0 : (totalPoints / totalCredits).toFixed(2);
                setStats({ creditsReg: semCreditsReg, creditsEarned: semCreditsEarned, sgpa: semData.gpa, cgpa: finalCGPA });
            };

            return (
                <div className="min-h-screen bg-gray-100 p-4 md:p-8 font-sans h-full overflow-auto">
                    <div className="no-print flex justify-between items-center mb-6 bg-white p-4 rounded shadow-sm border border-gray-200">
                        <h1 className="text-lg font-bold text-slate-700 flex items-center gap-2"><Icon name="GraduationCap"/> STUDENT PORTAL</h1>
                        <div className="flex gap-4">
                            <select className="border p-2 rounded bg-gray-50 text-sm font-bold outline-none cursor-pointer hover:bg-gray-100" 
                                onChange={(e) => handleSemChange(e.target.value)} value={selectedSem ? allResults.findIndex(s => s.semester === selectedSem.semester) : 0}>
                                {allResults.map((s, i) => <option key={i} value={i}>{s.semester}</option>)}
                            </select>
                            <button onClick={onLogout} className="text-xs bg-red-50 text-red-600 px-3 py-1 rounded border border-red-200 hover:bg-red-50">LOGOUT</button>
                        </div>
                    </div>

                    {allResults.length === 0 ? <div className="text-center text-gray-400 mt-20">No records found.</div> : selectedSem && (
                        <div className="max-w-5xl mx-auto bg-white shadow-xl min-h-[800px] relative print-border">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 p-8 border-b bg-gray-50">
                                <div className="bg-white p-4 border-l-4 border-red-600 shadow-sm"><p className="text-xs text-gray-500 uppercase font-bold">Credits Registered</p><p className="text-2xl font-bold text-slate-800">{stats.creditsReg}</p></div>
                                <div className="bg-white p-4 border-l-4 border-red-600 shadow-sm"><p className="text-xs text-gray-500 uppercase font-bold">Credits Earned</p><p className="text-2xl font-bold text-slate-800">{stats.creditsEarned}</p></div>
                                <div className="bg-white p-4 border-l-4 border-red-600 shadow-sm"><p className="text-xs text-gray-500 uppercase font-bold">SGPA</p><p className="text-2xl font-bold text-slate-800">{stats.sgpa}</p></div>
                                <div className="bg-white p-4 border-l-4 border-red-600 shadow-sm"><p className="text-xs text-gray-500 uppercase font-bold">CGPA</p><p className="text-2xl font-bold text-slate-800">{stats.cgpa}</p></div>
                            </div>
                            <div className="p-8 md:p-12">
                                <div className="text-center mb-8"><h1 className="text-3xl font-serif font-bold text-slate-900 uppercase">Institute of Technology</h1><p className="text-xs text-gray-500 mt-1 uppercase tracking-widest">Provisional Grade Card</p></div>
                                <div className="grid grid-cols-2 gap-x-12 gap-y-4 mb-8 font-serif text-sm">
                                    <div className="flex border-b border-gray-200 pb-1"><span className="font-bold w-32 text-gray-600">Name:</span> <span className="font-bold uppercase">{user.name}</span></div>
                                    <div className="flex border-b border-gray-200 pb-1"><span className="font-bold w-32 text-gray-600">USN:</span> <span className="font-bold">{user.id}</span></div>
                                    <div className="flex border-b border-gray-200 pb-1"><span className="font-bold w-32 text-gray-600">Branch:</span> <span className="uppercase">{getBranchName(user.department)}</span></div>
                                    <div className="flex border-b border-gray-200 pb-1"><span className="font-bold w-32 text-gray-600">Semester:</span> <span className="uppercase font-bold">{selectedSem.semester}</span></div>
                                </div>
                                <table className="w-full border-collapse text-xs md:text-sm mb-12 font-medium">
                                    <thead className="bg-gray-100 border-b-2 border-gray-300 text-gray-600 uppercase text-left"><tr><th className="p-3">Code</th><th className="p-3">Course Name</th><th className="p-3 text-center">Credits</th><th className="p-3 text-center">Grade</th><th className="p-3 text-center">Result</th></tr></thead>
                                    <tbody className="text-slate-700">{selectedSem.subjects.map((sub, i) => (<tr key={i} className="border-b hover:bg-gray-50"><td className="p-3 font-mono text-slate-500">{sub.code}</td><td className="p-3 font-bold">{sub.name}</td><td className="p-3 text-center">{sub.credits}</td><td className="p-3 text-center font-bold">{sub.grade}</td><td className="p-3 text-center"><span className={`px-2 py-1 rounded text-xs font-bold ${['F','Ab'].includes(sub.grade)?'bg-red-100 text-red-600':'bg-green-100 text-green-700'}`}>{['F','Ab'].includes(sub.grade)?'FAIL':'PASS'}</span></td></tr>))}</tbody>
                                </table>
                                <div className="absolute bottom-10 left-10 right-10 flex justify-between border-t border-gray-300 pt-4 font-serif text-xs text-gray-500"><p>Computer Generated Document</p><p className="font-bold text-black">Controller of Examinations</p></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            try {
                if (!user) return <Login onLogin={setUser} />;
                return user.role === 'admin' ? <AdminDashboard user={user} onLogout={()=>setUser(null)}/> : <StudentDashboard user={user} onLogout={()=>setUser(null)}/>;
            } catch (err) { return <div className="text-red-600 p-10 text-center">App Error: {err.message}</div>; }
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>